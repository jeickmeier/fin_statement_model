Below is a **merge-order roadmap** that slices the Template Registry & Engine (TRE) work into review-friendly, logically independent pull-requests.  Each PR builds on the previous one, so you can land usable increments quickly while keeping review size reasonable.

| #                                                   | Branch / Title                                                                                                                                                                                                            | Purpose & Key Scope                                                                                                           | Acceptance tests                                                                                   | Review Hints |
| --------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- | ------------ |
| **PR 1**<br/>`feat/tre-models`                      | **Introduce Pydantic v2 domain models** `TemplateMeta`, `TemplateBundle`, `DiffResult` in `fin_statement_model/templates/models.py`.<br/>\* Add `tests/templates/test_models.py` for schema validation & checksum helper. | • Models validate & freeze.<br/>• Round-trip `TemplateBundle.model_dump()` / `model_validate()` passes.                       | Cite existing Pydantic pattern (e.g. IO configs) for `ConfigDict(extra="forbid", frozen=True)` .   |              |
| **PR 2**<br/>`feat/tre-registry-store`              | **Local store & index**<br/>• `TemplateRegistry` skeleton re-using `_BaseRegistry` idiom for CRUD .<br/>• File layout under `$FSM_TEMPLATES_PATH` with atomic JSON writes.<br/>• CLI: `fsm template ls`.                  | • `TemplateRegistry.register_graph` & `list()` round-trip a dummy graph.<br/>• Index file created with correct perms (`600`). | Focus review on race-condition safety (use `pathlib.Path.rename` to atomically move temp → final). |              |
| **PR 3**<br/>`feat/graph-clone`                     | **Graph cloning & instantiation**<br/>• Add `Graph.clone(deep=True)` plus UUID regeneration.<br/>• `TemplateRegistry.instantiate()` uses clone; supports `periods=` & `rename_map=`.                                      | • Instantiate 2 000-node fixture in < 250 ms.<br/>• Node rename preserves edge wiring.                                        | Touch only `core/graph` mix-ins; follow existing constructor contract .                            |              |
| **PR 4**<br/>`feat/tre-diff-engine`                 | **Structure + Value diff**<br/>• New `diff.py` with `compare_structure()` & `compare_values()` helpers.<br/>• Add `TemplateRegistry.diff()` returning `DiffResult`.                                                       | • Unit tests: identical bundles → empty diff; changed formula → structural diff; changed output values → value diff.          | Keep value comparison via public `Graph.calculate`—no private cache poking.                        |              |
| **PR 5**<br/>`feat/tre-cli-apply-diff`              | **CLI plumbing** (`click`-based):<br/>`fsm template apply`, `fsm template diff` with pretty Markdown output.                                                                                                              | • CLI E2E tests via `pytest-subprocess`.                                                                                      | Follow existing CLI style in `fsm` tool (if any) for option names.                                 |              |
| **PR 6**<br/>`feat/tre-io-bridge`                   | **IO facade integration**<br/>• Register `"graph_definition_dict"` writer/reader pairing so templates export/import seamlessly, leveraging existing handler-registry pattern .                                            | • `write_data("graph_definition_dict")` produces same dict used inside `TemplateBundle.graph_dict`.                           | Ensure writer honours `include_nodes` so users can snapshot partial graphs later.                  |              |
| **PR 7**<br/>`tests/perf-security`                  | **Hardening pass**<br/>• Add SHA-256 verification & tamper test.<br/>• Multi-threaded instantiation benchmark in CI.<br/>• Path-traversal negative tests.                                                                 | • CI fails if instantiate > 250 ms (GitHub Actions, M1 runner).                                                               | Reviewers: perf tuning may require switching `json.load`→`orjson`.                                 |              |
| **PR 8**<br/>`docs/tre-usage` (**last merge-gate**) | **Docs & Examples**<br/>• User guide in `/docs/registry_templates.md`.<br/>• Ship two reference templates (`lbo.standard_v1`, `real_estate.lending_v2`).<br/>• MkDocs navigation update.                                  | • `make docs` builds without warnings.                                                                                        | After merge, cut release `v0.4.0-beta`.                                                            |              |

### Reviewer Checklist (per PR)

1. **API stability** — public signatures frozen once PR 5 lands.
2. **Type-safety** — new code passes `mypy --strict`.
3. **Coverage** — each PR must keep project coverage ≥ 80 %.
4. **Docs** — any new public symbol requires docstring + example.

Following this pull-request train will deliver the full Template Registry & Engine with minimal merge pain and clear review focus areas.
